<div
  th:fragment="date (question, questionRendererParams)"
  class="cf-question-date"
>
  <fieldset
    class="usa-fieldset"
    th:with="questionId=${#strings.randomAlphanumeric(8)},
             dateQuestion=${question.createDateQuestion()},
             firstPathWithError=${dateQuestion.getFirstPathWithError()}"
  >
    <!-- Title and Help Text -->
    <div
      th:replace="~{questiontypes/QuestionBaseFragment :: titleAndHelpTextMultipleInput(${question}, ${questionId})}"
    ></div>

    <!-- Display errors -->
    <div
      th:replace="~{questiontypes/QuestionBaseFragment :: validationErrors(${dateQuestion.getValidationErrors().get(question.getContextualizedPath())})}"
    ></div>

    <!-- Hidden input to delete the old single date value. -->
    <input text th:id="${dateQuestion.getDatePath()}" th:name="${dateQuestion.getDatePath()}" value="" class="border-2 border-black" />
    <div class="usa-memorable-date">
      <!-- Month Input -->
      <div
        class="usa-form-group usa-form-group--month usa-form-group--select cf-date-month"
        th:with="monthId=${#strings.randomAlphanumeric(8)},monthPath=${dateQuestion.getMonthPath()}"
      >
        <label
          class="usa-label"
          th:for="${monthId}"
          th:text="#{label.month}"
        ></label>
        <select
          class="usa-select"
          th:id="${monthId}"
          th:name="${dateQuestion.getMonthPath()}"
          th:with="value=${dateQuestion.getMonthValue().orElse('')}"
          th:aria-describedby="${questionId} + '-description'"
          th:autofocus="${questionRendererParams.autofocusFirstError() && !firstPathWithError.isEmpty() && firstPathWithError.get().equals(monthPath)}"
        >
          <option value>- Select -</option>
          <option
            value="1"
            th:text="#{content.january}"
            th:selected="${value == 1}"
          ></option>
          <option
            value="2"
            th:text="#{content.february}"
            th:selected="${value == 2}"
          ></option>
          <option
            value="3"
            th:text="#{content.march}"
            th:selected="${value == 3}"
          ></option>
          <option
            value="4"
            th:text="#{content.april}"
            th:selected="${value == 4}"
          ></option>
          <option
            value="5"
            th:text="#{content.may}"
            th:selected="${value == 5}"
          ></option>
          <option
            value="6"
            th:text="#{content.june}"
            th:selected="${value == 6}"
          ></option>
          <option
            value="7"
            th:text="#{content.july}"
            th:selected="${value == 7}"
          ></option>
          <option
            value="8"
            th:text="#{content.august}"
            th:selected="${value == 8}"
          ></option>
          <option
            value="9"
            th:text="#{content.september}"
            th:selected="${value == 9}"
          ></option>
          <option
            value="10"
            th:text="#{content.october}"
            th:selected="${value == 10}"
          ></option>
          <option
            value="11"
            th:text="#{content.november}"
            th:selected="${value == 11}"
          ></option>
          <option
            value="12"
            th:text="#{content.december}"
            th:selected="${value == 12}"
          ></option>
        </select>
        <div
          th:replace="~{questiontypes/QuestionBaseFragment :: validationErrors(${dateQuestion.getValidationErrors().get(dateQuestion.getMonthPath())})}"
        ></div>
      </div>
      <!-- Day of month input -->
      <div
        class="usa-form-group usa-form-group--day cf-date-day"
        th:with="dayId=${#strings.randomAlphanumeric(8)},dayPath=${dateQuestion.getDayPath()}"
      >
        <label
          class="usa-label"
          th:for="${dayId}"
          th:text="#{label.dayOfMonth}"
        ></label>
        <input
          class="usa-input"
          th:aria-describedby="${questionId} + '-description'"
          th:id="${dayId}"
          th:name="${dateQuestion.getDayPath()}"
          maxlength="2"
          pattern="[0-9]*"
          inputmode="numeric"
          th:value="${dateQuestion.getDayValue().orElse('')}"
          th:autofocus="${questionRendererParams.autofocusFirstError() && !firstPathWithError.isEmpty() && firstPathWithError.get().equals(dayPath)}"
        />
        <div
          th:replace="~{questiontypes/QuestionBaseFragment :: validationErrors(${dateQuestion.getValidationErrors().get(dateQuestion.getDayPath())})}"
        ></div>
      </div>
      <!-- Year input -->
      <div
        class="usa-form-group usa-form-group--year cf-date-year"
        th:with="yearId=${#strings.randomAlphanumeric(8)},yearPath=${dateQuestion.getYearPath()}"
      >
        <label
          class="usa-label"
          th:for="${yearId}"
          th:text="#{label.year}"
        ></label>
        <input
          class="usa-input"
          th:aria-describedby="${questionId} + '-description'"
          th:id="${yearId}"
          th:name="${dateQuestion.getYearPath()}"
          minlength="4"
          maxlength="4"
          pattern="[0-9]*"
          inputmode="numeric"
          th:value="${dateQuestion.getYearValue().orElse('')}"
          th:autofocus="${questionRendererParams.autofocusFirstError() && !firstPathWithError.isEmpty() && firstPathWithError.get().equals(yearPath)}"
        />
        <div
          th:replace="~{questiontypes/QuestionBaseFragment :: validationErrors(${dateQuestion.getValidationErrors().get(dateQuestion.getYearPath())})}"
        ></div>
      </div>
    </div>
  </fieldset>
<!--  <script type="text/javascript">-->
<!--    document.addEventListener("DOMContentLoaded", (event) => {-->
<!--      const dateQuestionEls = document.querySelectorAll('.cf-question-date');-->

<!--      for (let i = 0; i < dateQuestionEls.length; i++) {-->
<!--        const controls = dateQuestionEls[i].querySelectorAll('select.usa-select, input.usa-input')-->
<!--          for (let j = 0; j < controls.length; j++) {-->
<!--            controls[j].addEventListener('change', onChange);-->
<!--          }-->
<!--      }-->
<!--    });-->

<!--    function onChange(event) {-->
<!--      const dateQuestionEl = event.target.closest('.cf-question-date');-->

<!--      const monthEl = dateQuestionEl.querySelector('.cf-date-month select.usa-select');-->
<!--      const dayEl = dateQuestionEl.querySelector('.cf-date-day input.usa-input');-->
<!--      const yearEl = dateQuestionEl.querySelector('.cf-date-year input.usa-input');-->
<!--      const date = `${yearEl.value}-${monthEl.value.padStart(2, '0')}-${dayEl.value.padStart(2, '0')}`;-->

<!--      const dateEl = dateQuestionEl.querySelector('input');-->
<!--      dateEl.value = date;-->
<!--    }-->

<!--  </script>-->
</div>
